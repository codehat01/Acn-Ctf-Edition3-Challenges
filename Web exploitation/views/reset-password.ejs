<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Reset Password</title>
    <link rel="stylesheet" href="/styles.css">
</head>

<body>
    <%- include('partials/navbar') %> <!-- Including the navbar -->
        <div class="container">
            <h2>Reset Password</h2>
            <form onsubmit="handleSubmit(); return false;">
                <label>Username:</label><br>
                <input type="text" name="username" required><br>
                <label>Existing Password:</label><br>
                <input type="password" name="password" required><br>
                <label>New Password:</label><br>
                <input type="password" name="new-password" required><br>
                <button type="submit">Reset Password</button>
            </form>
            <br>
            <center>
                <a href="/login">Back to login</a>
            </center>
        </div>
        <script>
            function hash(value) {
                // hash the value using SHA-256 algorithm
                const hash = crypto.createHash('sha256');
                hash.update(value);
                return hash.digest('hex');
            }

            function handleSubmit() {

                const hashValue = val =>
                    crypto.subtle
                        .digest('SHA-256', new TextEncoder('utf-8').encode(val))
                        .then(h => {
                            let hexes = [],
                                view = new DataView(h);
                            for (let i = 0; i < view.byteLength; i += 4)
                                hexes.push(('00000000' + view.getUint32(i).toString(16)).slice(-8));
                            return hexes.join('');
                        });

                // hash the values and send them to the server
                var username = document.querySelector('input[name="username"]').value;
                var newPassword = document.querySelector('input[name="new-password"]').value;
                var password = document.querySelector('input[name="password"]').value;
                fetch(`/reset-password?y=${username}&z=${password}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        "password": newPassword
                    })
                }).then(res => {
                    if (res.status === 200) {
                        alert('Password reset successful');
                        console.log(res.json);
                    } else {
                        alert('Password reset failed');
                    }
                });
            }
        </script>
</body>

</html>